{"ast":null,"code":"import { Subject } from 'rxjs';\nimport { distinctUntilKeyChanged, takeUntil } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"services\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"ng-zorro-antd/divider\";\nimport * as i4 from \"share/customize/job-badge/job-badge.component\";\nimport * as i5 from \"share/customize/task-badge/task-badge.component\";\nimport * as i6 from \"share/common/navigation/navigation.component\";\nimport * as i7 from \"ng-zorro-antd/popconfirm\";\nimport * as i8 from \"ng-zorro-antd/skeleton\";\nimport * as i9 from \"../../../share/pipes/humanize-duration.pipe\";\n\nfunction JobStatusComponent_div_0_ng_container_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 8);\n    i0.ɵɵelementStart(2, \"div\");\n    i0.ɵɵtext(3, \"End Time:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\");\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(7, \"nz-divider\", 4);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(6, 2, ctx_r2.jobDetail[\"end-time\"], \"yyyy-MM-dd HH:mm:ss\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"nzType\", \"vertical\");\n  }\n}\n\nfunction JobStatusComponent_div_0_span_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r3.statusTips);\n  }\n}\n\nfunction JobStatusComponent_div_0_ng_container_32_a_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"a\", 13);\n    i0.ɵɵlistener(\"nzOnConfirm\", function JobStatusComponent_div_0_ng_container_32_a_1_Template_a_nzOnConfirm_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext(3);\n      return ctx_r6.cancelJob();\n    });\n    i0.ɵɵtext(1, \" Cancel Job \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction JobStatusComponent_div_0_ng_container_32_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, JobStatusComponent_div_0_ng_container_32_a_1_Template, 2, 0, \"a\", 12);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.webCancelEnabled && (ctx_r4.jobDetail.state == \"RUNNING\" || ctx_r4.jobDetail.state == \"CREATED\" || ctx_r4.jobDetail.state == \"RESTARTING\"));\n  }\n}\n\nfunction JobStatusComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵelementStart(1, \"div\", 3);\n    i0.ɵɵelementStart(2, \"h2\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"nz-divider\", 4);\n    i0.ɵɵelement(5, \"flink-job-badge\", 5);\n    i0.ɵɵelement(6, \"nz-divider\", 4);\n    i0.ɵɵelement(7, \"flink-task-badge\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 7);\n    i0.ɵɵelementStart(9, \"div\", 8);\n    i0.ɵɵelementStart(10, \"div\");\n    i0.ɵɵtext(11, \"ID:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\");\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(14, \"nz-divider\", 4);\n    i0.ɵɵelementStart(15, \"div\", 8);\n    i0.ɵɵelementStart(16, \"div\");\n    i0.ɵɵtext(17, \"Start Time:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"div\");\n    i0.ɵɵtext(19);\n    i0.ɵɵpipe(20, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(21, \"nz-divider\", 4);\n    i0.ɵɵtemplate(22, JobStatusComponent_div_0_ng_container_22_Template, 8, 5, \"ng-container\", 9);\n    i0.ɵɵelementStart(23, \"div\", 8);\n    i0.ɵɵelementStart(24, \"div\");\n    i0.ɵɵtext(25, \"Duration:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"div\");\n    i0.ɵɵtext(27);\n    i0.ɵɵpipe(28, \"humanizeDuration\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(29, \"flink-navigation\", 10);\n    i0.ɵɵelementStart(30, \"div\", 11);\n    i0.ɵɵtemplate(31, JobStatusComponent_div_0_span_31_Template, 2, 1, \"span\", 9);\n    i0.ɵɵtemplate(32, JobStatusComponent_div_0_ng_container_32_Template, 2, 1, \"ng-container\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r0.jobDetail.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"nzType\", \"vertical\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"state\", ctx_r0.jobDetail.state);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"nzType\", \"vertical\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"tasks\", ctx_r0.jobDetail[\"status-counts\"]);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r0.jobDetail.jid);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"nzType\", \"vertical\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(20, 14, ctx_r0.jobDetail[\"start-time\"], \"yyyy-MM-dd HH:mm:ss\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"nzType\", \"vertical\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.jobDetail[\"end-time\"] > -1);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(28, 17, ctx_r0.jobDetail.duration));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"listOfNavigation\", ctx_r0.listOfNavigation);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.statusTips);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.statusTips);\n  }\n}\n\nfunction JobStatusComponent_nz_skeleton_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"nz-skeleton\", 14);\n  }\n\n  if (rf & 2) {\n    i0.ɵɵproperty(\"nzActive\", true);\n  }\n}\n\nexport let JobStatusComponent = /*#__PURE__*/(() => {\n  class JobStatusComponent {\n    constructor(jobService, statusService, cdr) {\n      this.jobService = jobService;\n      this.statusService = statusService;\n      this.cdr = cdr;\n      this.isLoading = true;\n      this.destroy$ = new Subject();\n      this.listOfNavigation = [{\n        path: 'overview',\n        title: 'Overview'\n      }, {\n        path: 'exceptions',\n        title: 'Exceptions'\n      }, {\n        path: 'timeline',\n        title: 'TimeLine'\n      }, {\n        path: 'checkpoints',\n        title: 'Checkpoints'\n      }, {\n        path: 'configuration',\n        title: 'Configuration'\n      }];\n      this.checkpointIndexOfNavigation = this.checkpointIndexOfNav();\n      this.webCancelEnabled = this.statusService.configuration.features[\"web-cancel\"];\n    }\n\n    cancelJob() {\n      this.jobService.cancelJob(this.jobDetail.jid).subscribe(() => {\n        this.statusTips = 'Cancelling...';\n        this.cdr.markForCheck();\n      });\n    }\n\n    ngOnInit() {\n      const jobDetail$ = this.jobService.jobDetail$.pipe(takeUntil(this.destroy$));\n      jobDetail$.subscribe(data => {\n        this.jobDetail = data;\n        this.cdr.markForCheck();\n        var index = this.checkpointIndexOfNav();\n\n        if (data.plan.type == 'STREAMING' && index == -1) {\n          this.listOfNavigation.splice(this.checkpointIndexOfNavigation, 0, {\n            path: 'checkpoints',\n            title: 'Checkpoints'\n          });\n        } else if (data.plan.type == 'BATCH' && index > -1) {\n          this.listOfNavigation.splice(index, 1);\n        }\n      });\n      jobDetail$.pipe(distinctUntilKeyChanged('state')).subscribe(() => {\n        this.statusTips = '';\n      });\n    }\n\n    ngOnDestroy() {\n      this.destroy$.next();\n      this.destroy$.complete();\n    }\n\n    checkpointIndexOfNav() {\n      return this.listOfNavigation.findIndex(item => item.path === 'checkpoints');\n    }\n\n  }\n\n  JobStatusComponent.ɵfac = function JobStatusComponent_Factory(t) {\n    return new (t || JobStatusComponent)(i0.ɵɵdirectiveInject(i1.JobService), i0.ɵɵdirectiveInject(i1.StatusService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n  };\n\n  JobStatusComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: JobStatusComponent,\n    selectors: [[\"flink-job-status\"]],\n    inputs: {\n      isLoading: \"isLoading\"\n    },\n    decls: 2,\n    vars: 2,\n    consts: [[\"class\", \"wrapper\", 4, \"ngIf\"], [3, \"nzActive\", 4, \"ngIf\"], [1, \"wrapper\"], [1, \"name\"], [3, \"nzType\"], [3, \"state\"], [3, \"tasks\"], [1, \"status\"], [1, \"field\"], [4, \"ngIf\"], [3, \"listOfNavigation\"], [1, \"operate\"], [\"nz-popconfirm\", \"\", \"nzPopconfirmTitle\", \"Cancel Job?\", \"nzOkText\", \"Yes\", \"nzCancelText\", \"No\", 3, \"nzOnConfirm\", 4, \"ngIf\"], [\"nz-popconfirm\", \"\", \"nzPopconfirmTitle\", \"Cancel Job?\", \"nzOkText\", \"Yes\", \"nzCancelText\", \"No\", 3, \"nzOnConfirm\"], [3, \"nzActive\"]],\n    template: function JobStatusComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, JobStatusComponent_div_0_Template, 33, 19, \"div\", 0);\n        i0.ɵɵtemplate(1, JobStatusComponent_nz_skeleton_1_Template, 1, 1, \"nz-skeleton\", 1);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.jobDetail && !ctx.isLoading);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isLoading);\n      }\n    },\n    directives: [i2.NgIf, i3.NzDividerComponent, i4.JobBadgeComponent, i5.TaskBadgeComponent, i6.NavigationComponent, i7.NzPopconfirmDirective, i8.NzSkeletonComponent],\n    pipes: [i2.DatePipe, i9.HumanizeDurationPipe],\n    styles: [\"[_nghost-%COMP%]{display:block;background:#fff;padding:16px 32px 0;border-bottom:1px solid #f0f0f0;margin:-24px -24px 0}.wrapper[_ngcontent-%COMP%]{position:relative}.name[_ngcontent-%COMP%]   flink-job-badge[_ngcontent-%COMP%], .name[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:inline-block}.name[_ngcontent-%COMP%]   nz-divider[_ngcontent-%COMP%]{margin:0 12px}.field[_ngcontent-%COMP%]{display:flex;font-size:14px}.field[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{line-height:22px}.field[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child{margin-left:8px;font-weight:700;color:rgba(0,0,0,.85)}.status[_ngcontent-%COMP%]{margin-bottom:12px;display:flex;align-items:center}.status[_ngcontent-%COMP%]   nz-divider[_ngcontent-%COMP%]{margin:0 24px}.operate[_ngcontent-%COMP%]{font-size:24px;position:absolute;right:16px;top:24px}flink-navigation[_ngcontent-%COMP%]{margin-bottom:-1px;display:block}flink-task-badge[_ngcontent-%COMP%]{display:inline-block}\"],\n    changeDetection: 0\n  });\n  return JobStatusComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}