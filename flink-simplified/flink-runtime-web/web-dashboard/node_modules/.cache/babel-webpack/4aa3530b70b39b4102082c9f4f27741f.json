{"ast":null,"code":"import { __rest } from \"tslib\";\n/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { formatDate } from '@angular/common';\nimport { distinctUntilChanged, flatMap, tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"services\";\nimport * as i2 from \"ng-zorro-antd/tabs\";\nimport * as i3 from \"share/common/monaco-editor/monaco-editor.component\";\nimport * as i4 from \"ng-zorro-antd/table\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"ng-zorro-antd/core/transition-patch\";\nimport * as i8 from \"ng-zorro-antd/button\";\nimport * as i9 from \"ng-zorro-antd/core/wave\";\n\nfunction JobExceptionsComponent_ng_container_17_nz_option_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"nz-option\", 16);\n    i0.ɵɵelementStart(1, \"span\", 17);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ex_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"nzLabel\", ex_r6.taskName)(\"nzValue\", ex_r6);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"nzTitle\", ex_r6.taskName);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ex_r6.taskName);\n  }\n}\n\nfunction JobExceptionsComponent_ng_container_17_flink_monaco_editor_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"flink-monaco-editor\", 18);\n  }\n\n  if (rf & 2) {\n    const item_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵproperty(\"value\", item_r3.selected.stacktrace);\n  }\n}\n\nfunction JobExceptionsComponent_ng_container_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"tr\");\n    i0.ɵɵelementStart(2, \"td\", 8);\n    i0.ɵɵlistener(\"nzExpandChange\", function JobExceptionsComponent_ng_container_17_Template_td_nzExpandChange_2_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const item_r3 = restoredCtx.$implicit;\n      return item_r3.expand = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵelementStart(7, \"div\", 9);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\", 10);\n    i0.ɵɵelementStart(10, \"nz-select\", 11);\n    i0.ɵɵlistener(\"ngModelChange\", function JobExceptionsComponent_ng_container_17_Template_nz_select_ngModelChange_10_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const item_r3 = restoredCtx.$implicit;\n      return item_r3.selected = $event;\n    });\n    i0.ɵɵtemplate(11, JobExceptionsComponent_ng_container_17_nz_option_11_Template, 3, 4, \"nz-option\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"td\");\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"tr\", 13);\n    i0.ɵɵelementStart(15, \"td\", 14);\n    i0.ɵɵtemplate(16, JobExceptionsComponent_ng_container_17_flink_monaco_editor_16_Template, 1, 1, \"flink-monaco-editor\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const item_r3 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"nzExpand\", item_r3.expand);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 9, item_r3.selected.timestamp, \"yyyy-MM-dd HH:mm:ss\"));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(item_r3.selected.exceptionName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"nzDisabled\", item_r3.exceptions.length == 1)(\"ngModel\", item_r3.selected);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", item_r3.exceptions);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r3.selected.location || \"(unassigned)\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"nzExpand\", item_r3.expand);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", item_r3.expand);\n  }\n}\n\nfunction JobExceptionsComponent_tr_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵelementStart(1, \"td\", 19);\n    i0.ɵɵelement(2, \"i\", 20);\n    i0.ɵɵtext(3, \"\\u00A0 \");\n    i0.ɵɵelementStart(4, \"i\");\n    i0.ɵɵtext(5, \"The exception history is limited to the most recent failures that caused parts of the job or the entire job to restart. The maximum history size can be configured via the Flink configuration property \");\n    i0.ɵɵelementStart(6, \"b\");\n    i0.ɵɵtext(7, \"web.exception-history-size\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(8, \".\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction JobExceptionsComponent_tr_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵelementStart(1, \"td\", 19);\n    i0.ɵɵelementStart(2, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function JobExceptionsComponent_tr_19_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.loadMore();\n    });\n    i0.ɵɵtext(3, \"Load More\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"nzLoading\", ctx_r2.isLoading);\n  }\n}\n\nconst _c0 = function () {\n  return {\n    inkBar: true,\n    tabPane: false\n  };\n};\n\nconst stripConcurrentExceptions = function (rootException) {\n  const {\n    concurrentExceptions\n  } = rootException,\n        mainException = __rest(rootException, [\"concurrentExceptions\"]);\n\n  return mainException;\n};\n\nconst markGlobalFailure = function (exception) {\n  if (exception.taskName == null) {\n    exception.taskName = '(global failure)';\n  }\n\n  return exception;\n};\n\nexport let JobExceptionsComponent = /*#__PURE__*/(() => {\n  class JobExceptionsComponent {\n    constructor(jobService, cdr) {\n      this.jobService = jobService;\n      this.cdr = cdr;\n      this.rootException = '';\n      this.exceptionHistory = [];\n      this.truncated = false;\n      this.isLoading = false;\n      this.maxExceptions = 0;\n      this.total = 0;\n    }\n\n    trackExceptionBy(_, node) {\n      return node.timestamp;\n    }\n\n    loadMore() {\n      this.isLoading = true;\n      this.maxExceptions += 10;\n      this.jobService.jobDetail$.pipe(distinctUntilChanged((pre, next) => pre.jid === next.jid), flatMap(job => this.jobService.loadExceptions(job.jid, this.maxExceptions)), tap(() => {\n        this.isLoading = false;\n        this.cdr.markForCheck();\n      })).subscribe(data => {\n        // @ts-ignore\n        const exceptionHistory = data.exceptionHistory;\n\n        if (exceptionHistory.entries.length > 0) {\n          const mostRecentException = exceptionHistory.entries[0];\n          this.rootException = formatDate(mostRecentException.timestamp, 'yyyy-MM-dd HH:mm:ss', 'en') + '\\n' + mostRecentException.stacktrace;\n        } else {\n          this.rootException = 'No Root Exception';\n        }\n\n        this.truncated = exceptionHistory.truncated;\n        this.exceptionHistory = exceptionHistory.entries.map(entry => {\n          const values = [stripConcurrentExceptions(entry)].concat(entry.concurrentExceptions).map(markGlobalFailure);\n          return {\n            selected: values[0],\n            exceptions: values,\n            expand: false\n          };\n        });\n      });\n    }\n\n    ngOnInit() {\n      this.loadMore();\n    }\n\n  }\n\n  JobExceptionsComponent.ɵfac = function JobExceptionsComponent_Factory(t) {\n    return new (t || JobExceptionsComponent)(i0.ɵɵdirectiveInject(i1.JobService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n  };\n\n  JobExceptionsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: JobExceptionsComponent,\n    selectors: [[\"flink-job-exceptions\"]],\n    decls: 20,\n    vars: 12,\n    consts: [[3, \"nzSize\", \"nzAnimated\"], [\"nzTitle\", \"Root Exception\", \"nzForceRender\", \"\"], [3, \"value\"], [\"nzTitle\", \"Exception History\", \"nzForceRender\", \"\"], [1, \"no-border\", \"small\", 3, \"nzSize\", \"nzData\", \"nzShowPagination\", \"nzFrontPagination\"], [\"nzWidth\", \"60px\"], [4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [4, \"ngIf\"], [\"nzShowExpand\", \"\", 3, \"nzExpand\", \"nzExpandChange\"], [1, \"name\"], [1, \"select-td\"], [\"nzShowSearch\", \"\", 1, \"exception-select\", 3, \"nzDisabled\", \"ngModel\", \"ngModelChange\"], [\"nzCustomContent\", \"\", 3, \"nzLabel\", \"nzValue\", 4, \"ngFor\", \"ngForOf\"], [3, \"nzExpand\"], [\"colspan\", \"5\", 1, \"expand-td\"], [\"class\", \"subtask\", 3, \"value\", 4, \"ngIf\"], [\"nzCustomContent\", \"\", 3, \"nzLabel\", \"nzValue\"], [\"nz-tooltip\", \"\", \"nzMouseEnterDelay\", \"0.5\", \"nzPlacement\", \"left\", 3, \"nzTitle\"], [1, \"subtask\", 3, \"value\"], [\"colspan\", \"5\"], [\"nz-icon\", \"\", \"nzType\", \"info-circle\", \"nzTheme\", \"fill\"], [\"nz-button\", \"\", \"nzBlock\", \"\", \"nzType\", \"primary\", \"nzGhost\", \"\", 3, \"nzLoading\", \"click\"]],\n    template: function JobExceptionsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"nz-tabset\", 0);\n        i0.ɵɵelementStart(1, \"nz-tab\", 1);\n        i0.ɵɵelement(2, \"flink-monaco-editor\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"nz-tab\", 3);\n        i0.ɵɵelementStart(4, \"nz-table\", 4);\n        i0.ɵɵelementStart(5, \"thead\");\n        i0.ɵɵelementStart(6, \"tr\");\n        i0.ɵɵelement(7, \"th\", 5);\n        i0.ɵɵelementStart(8, \"th\");\n        i0.ɵɵtext(9, \"Time\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"th\");\n        i0.ɵɵtext(11, \"Exception\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"th\");\n        i0.ɵɵtext(13, \"Task Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"th\");\n        i0.ɵɵtext(15, \"Location\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"tbody\");\n        i0.ɵɵtemplate(17, JobExceptionsComponent_ng_container_17_Template, 17, 12, \"ng-container\", 6);\n        i0.ɵɵtemplate(18, JobExceptionsComponent_tr_18_Template, 9, 0, \"tr\", 7);\n        i0.ɵɵtemplate(19, JobExceptionsComponent_tr_19_Template, 4, 1, \"tr\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"nzSize\", \"small\")(\"nzAnimated\", i0.ɵɵpureFunction0(11, _c0));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"value\", ctx.rootException);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"nzSize\", \"small\")(\"nzData\", ctx.exceptionHistory)(\"nzShowPagination\", false)(\"nzFrontPagination\", false);\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngForOf\", ctx.exceptionHistory)(\"ngForTrackBy\", ctx.trackExceptionBy);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.exceptionHistory.length > 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.truncated);\n      }\n    },\n    directives: [i2.NzTabSetComponent, i2.NzTabComponent, i3.MonacoEditorComponent, i4.NzTableComponent, i4.NzTheadComponent, i4.NzTrDirective, i4.NzTableCellDirective, i4.NzThMeasureDirective, i4.NzTbodyComponent, i5.NgForOf, i5.NgIf, i4.NzTdAddOnComponent, i6.NgControlStatus, i6.NgModel, i4.NzTrExpandDirective, i4.NzTableFixedRowComponent, i7.ɵNzTransitionPatchDirective, i8.NzButtonComponent, i9.NzWaveDirective],\n    pipes: [i5.DatePipe],\n    styles: [\"[_nghost-%COMP%]     .ant-tabs-nav-list{padding:4px 16px}nz-table[_ngcontent-%COMP%]{margin-top:-16px}flink-monaco-editor[_ngcontent-%COMP%]{height:calc(100vh - 346px)}flink-monaco-editor.subtask[_ngcontent-%COMP%]{height:300px}.expand-td[_ngcontent-%COMP%]{display:block;padding:0!important}.exception-select[_ngcontent-%COMP%]{width:300px}\"],\n    changeDetection: 0\n  });\n  return JobExceptionsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}